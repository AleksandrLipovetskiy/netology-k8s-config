name: Deploy to Kubernetes

on:
  push:
      branches:
            - main
                paths:
                      - 'manifests/**'
                        workflow_dispatch:

                        jobs:
                          deploy:
                              runs-on: ubuntu-latest
                                  steps:
                                        - name: Checkout repository
                                                uses: actions/checkout@v3

                                                      - name: Configure kubectl
                                                              run: |
                                                                        mkdir -p $HOME/.kube
                                                                                  echo "${{ secrets.KUBECONFIG }}" | base64 -d > $HOME/.kube/config
                                                                                            chmod 600 $HOME/.kube/config

                                                                                                  - name: Apply Kubernetes manifests
                                                                                                          run: kubectl apply -f manifests/
                                                                                                          
                                                                                                                - name: Wait for rollout
                                                                                                                        run: kubectl rollout status deployment/netology-app -n netology --timeout=5m
